var FloDialog=function(e){this.id=Date.now(),this.callback=null,this.cloak=this.renderCloakHtml(),this.activeDialog=null,this.content="",this.footerText="",this.config=this.mergeOptions({debug:!1,autoBind:!0,cache:!0,position:"absolute",closeOnCloakClick:!0,effect:{fade:!1,fall:!1}},e),this.config.autoBind&&this.bindFloDialogLinks(),this.loadPolyFills()};FloDialog.prototype.mergeOptions=function(e,t){var o={};for(var i in e)e.hasOwnProperty(i)&&(o[i]=e[i]);for(var n in t)t.hasOwnProperty(n)&&(o[n]=t[n]);return o},FloDialog.prototype.fadeIn=function(e,t){e.style.opacity=0;var o=function(){e.style.opacity=+e.style.opacity+.05,+e.style.opacity<1?window.requestAnimationFrame&&requestAnimationFrame(o)||setTimeout(o,16):"function"==typeof t&&t()};o()},FloDialog.prototype.bindFloDialogLinks=function(){for(var e=document.querySelectorAll("[data-flo-dialog]"),t=0;t<e.length;t++)this.addEvent(e[t],"click",function(e){e.preventDefault();var t=e.currentTarget?e.currentTarget:e.srcElement;switch(t.getAttribute("data-flo-dialog")){case"partial":this.partialHandler(t);break;case"hidden-element":this.hiddenElementHandler(t);break;case"image":this.imageHandler(t)}}.bind(this))},FloDialog.prototype.partialHandler=function(e){var t={title:e.getAttribute("data-title"),url:e.getAttribute("data-url")};null!==t.url&&""!==t.url&&"javascript:"!==t.url&&"#"!==t.url&&this.openUrl(t.title,t.url)},FloDialog.prototype.hiddenElementHandler=function(e){var t={id:e.getAttribute("data-id"),title:e.getAttribute("data-title")};if(null!==t.id){var o=document.getElementById(t.id),i=document.createElement("div");i.appendChild(o.firstChild.cloneNode(!0)),this.content=i.innerHTML,this.openDialog(t.title)}},FloDialog.prototype.imageHandler=function(e){var t={title:e.getAttribute("data-title"),imageUrl:e.getAttribute("data-image-url")};if(null!==t.imageUrl){var o=document.createElement("img");o.src=t.imageUrl,o.className="flo-dialog__img",this.content=o.outerHTML,this.openDialog(t.title)}},FloDialog.prototype.openUrl=function(t,e,o){var i=this;i.get(e).then(function(e){i.content=e,i.positionDialog(),i.openDialog(t,o)}).catch(function(e){console.error(e)})},FloDialog.prototype.openDialog=function(e,t){var o=this;this.title=e,this.callback=t||null,o.activeDialog?(o.resetContent(),o.updateActiveDialog().then(function(){o.positionDialog()})):o.renderDialog().then(function(e){o.positionDialog(),"function"==typeof t&&t()}).catch(function(e){console.error(e)})},FloDialog.prototype.renderDialog=function(){var e=this.renderDialogHtml(),t=document.getElementsByTagName("body")[0],o=this,i=0;return o.config.debug&&(i=500),t.appendChild(e),this.activeDialog=e,Promise.all([o.showDialog(),o.appendTitle(o.title),o.appendContent(o.content,i)]).then(function(){return e})},FloDialog.prototype.updateActiveDialog=function(){var e=this,t=0;return e.config.debug&&(t=500),Promise.all([this.showDialog(),e.appendTitle(e.title),e.appendContent(e.content,t)]).then(function(){return e.activeDialog})},FloDialog.prototype.showDialog=function(){var o=this.activeDialog,i=this;return new Promise(function(e,t){i.openCloak(),i.positionDialog(),i.config.effect.fade?(o.style.display="block",i.fadeIn(o,function(){i.runEmbeddedJs(),e()})):(i.runEmbeddedJs(),e())})},FloDialog.prototype.positionDialog=function(){var t=(window.pageYOffset||document.body.scrollTop)-(document.body.clientTop||0),o=Math.max(document.documentElement.clientHeight,window.innerHeight||0),i=this.activeDialog;this.waitForElement(i,function(){var e=o-o/10;i.style.height="auto",i.style.overflowY="visible",i.offsetHeight>e&&(i.style.overflowY="scroll",i.style.height=e+"px"),"fixed"===this.config.position&&(t=0,i.style.position="fixed"),i.style.top=t+o/2-i.offsetHeight/2+"px",this.config.debug&&(console.log("dialog.offsetHeight: "+i.offsetHeight),console.log("screenHeight: "+o),console.log("positionTop: "+t),console.log("maxHeight: "+e))}.bind(this))},FloDialog.prototype.waitForElement=function(e,t){var o=setInterval(function(){e&&(clearInterval(o),t())},10)},FloDialog.prototype.closeDialog=function(){var e=this.activeDialog||null;void 0!==e&&(this.config.effect.fade&&(this.activeDialog.style.display="none"),this.config.cache||(e.parentNode.removeChild(e),this.activeDialog=null),this.closeCloak())},FloDialog.prototype.openCloak=function(){var e=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight);void 0!==this.cloak&&(this.cloak.setAttribute("style","height: "+e+"px"),this.cloak.className=this.cloak.className.replace(/\bhide\b/g,""))},FloDialog.prototype.closeCloak=function(){void 0!==this.cloak&&-1===this.cloak.className.indexOf("hide")&&(this.cloak.className+=" hide")},FloDialog.prototype.appendTitle=function(i){var n=this;if(void 0!==n.activeDialog)return new Promise(function(e,t){var o=n.activeDialog.getElementsByClassName("flo-dialog__header")[0];void 0!==o?(o.getElementsByClassName("title")[0].innerHTML=i,e()):t()})},FloDialog.prototype.appendContent=function(i,e){e=e||0;var n=this;if(void 0!==n.activeDialog)return new Promise(function(t,o){setTimeout(function(){var e=n.activeDialog.getElementsByClassName("flo-dialog__body")[0];void 0!==e?(e.innerHTML=i,t()):o()},e)})},FloDialog.prototype.resetContent=function(){this.activeDialog.getElementsByClassName("flo-dialog__body")[0].innerHTML=this.renderSpinnerHtml()},FloDialog.prototype.addEvent=function(e,t,o){e.attachEvent?(e["e"+t+o]=o,e[t+o]=function(){e["e"+t+o](window.event)},e.attachEvent("on"+t,e[t+o])):e.addEventListener(t,o,!1)},FloDialog.prototype.get=function(i){var e=new Promise(function(e,t){var o=new XMLHttpRequest;o.open("GET",i),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.onload=function(){200===o.status?e(o.response):t(Error(o.statusText))},o.send()});return Promise.all([e]).then(function(e){return e[0]})},FloDialog.prototype.renderCloakHtml=function(){var e=document.createElement("div"),t=document.getElementsByTagName("body")[0];return e.className="flo-dialog-cloak hide",t.insertBefore(e,t.firstChild),this.addEvent(e,"click",function(e){e.target!==this.activeDialog&&this.closeDialog()}.bind(this)),e},FloDialog.prototype.renderDialogHtml=function(){var e=document.createElement("div"),t=document.createElement("div"),o=document.createElement("div"),i=document.createElement("header"),n=document.createElement("footer"),l=document.createElement("div"),a=document.createElement("div"),r=document.createElement("h2"),s=document.createElement("a"),c=document.createElement("i");return e.id="flo-dialog-"+this.id,e.className="flo-dialog hide",t.className="flo-dialog__inner",e.appendChild(t),i.className="flo-dialog__header trailer--half",t.appendChild(i),l.className="container container--master",i.appendChild(l),r.className="title title--dialog gutters--double",l.appendChild(r),a.className="container container--slave",a.style.textAlign="right",i.appendChild(a),c.className="fa fa-times",s.appendChild(c),s.href="JavaScript:;",s.className="flo-dialog__close-btn gutters--double",a.appendChild(s),this.addEvent(s,"click",this.closeDialog.bind(this)),o.className="flo-dialog__body gutters--double",o.innerHTML=this.renderSpinnerHtml(),t.appendChild(o),n.className="flo-dialog__footer gutters--double leader-inside--half",n.innerHTML=""!==this.footerText?this.footerText:"&copy; FloDialog "+(new Date).getFullYear()+". All rights reserved.",t.appendChild(n),e},FloDialog.prototype.runEmbeddedJs=function(){for(var scripts=this.activeDialog.getElementsByTagName("script"),i=0;i<scripts.length;i++)eval(scripts[i].text)},FloDialog.prototype.setFooterText=function(e){this.footerText=e},FloDialog.prototype.renderSpinnerHtml=function(){return'<svg class="flo-dialog__spinner" viewBox="0 0 100 100" width="20" height="20"> <circle cx="50" cy="50" r="42" transform="rotate(-90,50,50)" /></svg>'},FloDialog.loadPolyFills=function(){if(!this.isIe()){var e=document.createElement("script"),t=document.getElementsByTagName("head")[0];e.type="text/javascript",e.src="https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.min.js",t.appendChild(e)}},FloDialog.prototype.isIe=function(){return 0<window.navigator.userAgent.indexOf("MSIE ")||!!navigator.userAgent.match(/Trident.*rv\:11\./)};