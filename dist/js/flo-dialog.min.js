var FloDialog=function(t){this.id=Date.now(),this.callback=null,this.cloak=this.renderCloakHtml(),this.activeDialog=null,this.content="",this.footerText="",this.config=this.mergeOptions({autoBind:!0,cache:!0,position:"absolute",closeOnCloakClick:!0,effect:{fade:!1,fall:!1}},t),this.config.autoBind&&this.bindFloDialogLinks()};FloDialog.prototype.mergeOptions=function(t,e){var i={};for(var o in t)t.hasOwnProperty(o)&&(i[o]=t[o]);for(var a in e)e.hasOwnProperty(a)&&(i[a]=e[a]);return i},FloDialog.prototype.fadeIn=function(t,e){t.style.opacity=0;var i=function(){t.style.opacity=+t.style.opacity+.05,+t.style.opacity<1?window.requestAnimationFrame&&requestAnimationFrame(i)||setTimeout(i,16):"function"==typeof e&&e()};i()},FloDialog.prototype.bindFloDialogLinks=function(){for(var t=document.querySelectorAll("[data-flo-dialog]"),e=0;e<t.length;e++)this.addEvent(t[e],"click",function(t){t.preventDefault();var e=t.currentTarget?t.currentTarget:t.srcElement;switch(e.getAttribute("data-flo-dialog")){case"partial":this.partialHandler(e);break;case"hidden-element":this.hiddenElementHandler(e);break;case"image":this.imageHandler(e)}}.bind(this))},FloDialog.prototype.partialHandler=function(t){var e={title:t.getAttribute("data-title"),url:t.getAttribute("data-url")};null!==e.url&&""!==e.url&&"javascript:"!==e.url&&"#"!==e.url&&this.openUrl(e.title,e.url,null)},FloDialog.prototype.hiddenElementHandler=function(t){var e={id:t.getAttribute("data-id"),title:t.getAttribute("data-title")};if(null!==e.id){var i=document.getElementById(e.id),o=document.createElement("div");o.appendChild(i.firstChild.cloneNode(!0)),this.content=o,this.openDialog(e.title)}},FloDialog.prototype.imageHandler=function(t){var e=document.createElement("div"),i={title:t.getAttribute("data-title"),imageUrl:t.getAttribute("data-image-url")};if(null!==i.imageUrl){var o=document.createElement("img");o.src=i.imageUrl,o.className="flo-dialog__img",e.appendChild(o),this.content=e,this.openDialog(i.title)}},FloDialog.prototype.openUrl=function(t,e,i){var o=document.createElement("span"),a=document.createElement("div");o.textContent="Loading...",a.appendChild(o),this.get(e,function(e){a.innerHTML=e.data,this.waitForElement(a,function(){this.content=a,this.positionDialog(),this.openDialog(t),"function"==typeof i&&i()}.bind(this))}.bind(this))},FloDialog.prototype.openDialog=function(t,e){this.title=t,this.callback=e||null,this.activeDialog?this.updateActiveDialog():this.renderDialog()},FloDialog.prototype.renderDialog=function(){var t=this.renderContainerHtml(this.content);document.getElementsByTagName("body")[0].appendChild(t),this.activeDialog=t,this.appendTitle(this.title),this.showDialog()},FloDialog.prototype.updateActiveDialog=function(){this.appendContent(this.content),this.appendTitle(this.title),this.showDialog()},FloDialog.prototype.showDialog=function(){var t=this.activeDialog,e=this.callback;t.className=t.className.replace(/\bhide\b/,""),this.openCloak(),this.positionDialog(),this.config.effect.fade?(t.style.display="block",this.fadeIn(t,function(){this.runEmbeddedJs(),"function"==typeof e&&e()}.bind(this))):"function"==typeof e&&(this.runEmbeddedJs(),e())},FloDialog.prototype.positionDialog=function(t){var e=(window.pageYOffset||document.body.scrollTop)-(document.body.clientTop||0),i=Math.max(document.documentElement.clientHeight,window.innerHeight||0),o=this.activeDialog;this.waitForElement(o,function(){var a=i-i/10;o.offsetHeight>a&&(o.style.overflowY="scroll",o.style.height=a+"px"),o.style.top=e+i/2-o.offsetHeight/2+"px","fixed"===this.config.position&&(o.style.position="fixed"),"function"==typeof t&&t()}.bind(this))},FloDialog.prototype.waitForElement=function(t,e){var i=setInterval(function(){t&&(clearInterval(i),e())},10)},FloDialog.prototype.closeDialog=function(){var t=this.activeDialog||null;void 0!==t&&(this.config.effect.fade&&(this.activeDialog.style.display="none"),this.config.cache||(t.parentNode.removeChild(t),this.activeDialog=null),this.closeCloak())},FloDialog.prototype.openCloak=function(){var t=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight);void 0!==this.cloak&&(this.cloak.setAttribute("style","height: "+t+"px"),this.cloak.className=this.cloak.className.replace(/\bhide\b/g,""))},FloDialog.prototype.closeCloak=function(){void 0!==this.cloak&&-1===this.cloak.className.indexOf("hide")&&(this.cloak.className+=" hide")},FloDialog.prototype.appendTitle=function(t){if(void 0!==this.activeDialog){var e=this.activeDialog.getElementsByClassName("flo-dialog__header")[0];void 0!==e&&(e.getElementsByClassName("title")[0].innerHTML=t)}},FloDialog.prototype.appendContent=function(t){if(void 0!==this.activeDialog){var e=this.activeDialog.getElementsByClassName("flo-dialog__body")[0];void 0!==e&&(e.innerHTML="",e.appendChild(t))}},FloDialog.prototype.addEvent=function(t,e,i){t.attachEvent?(t["e"+e+i]=i,t[e+i]=function(){t["e"+e+i](window.event)},t.attachEvent("on"+e,t[e+i])):t.addEventListener(e,i,!1)},FloDialog.prototype.get=function(t,e){var i=new XMLHttpRequest,o={};i.open("GET",t),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.onload=function(){200===i.status?(o.data=i.responseText,e(o)):console.error("Request failed.  Returned status of "+i.status)},i.send()},FloDialog.prototype.renderCloakHtml=function(){var t=document.createElement("div"),e=document.getElementsByTagName("body")[0];return t.className="flo-dialog-cloak hide",e.insertBefore(t,e.firstChild),this.addEvent(t,"click",function(t){t.target!==this.activeDialog&&this.closeDialog()}.bind(this)),t},FloDialog.prototype.renderContainerHtml=function(t){t=t||document.createElement("div");var e=document.createElement("div"),i=document.createElement("header"),o=document.createElement("footer"),a=document.createElement("div"),l=document.createElement("div"),n=document.createElement("h2"),s=document.createElement("a"),r=document.createElement("i");return e.id="flo-dialog-"+this.id,e.className="flo-dialog hide",i.className="flo-dialog__header trailer--half",e.appendChild(i),a.className="container container--master",i.appendChild(a),n.className="title title--section gutters--double",n.innerHTML="No title was set!",a.appendChild(n),l.className="container container--slave",l.style.textAlign="right",i.appendChild(l),r.className="fa fa-times",s.appendChild(r),s.href="JavaScript:;",s.className="flo-dialog__close-btn gutters--double",l.appendChild(s),this.addEvent(s,"click",this.closeDialog.bind(this)),t.className="flo-dialog__body gutters--double",e.appendChild(t),o.className="flo-dialog__footer gutters--double leader-inside--half",o.innerHTML=""!==this.footerText?this.footerText:"&copy; FloDialog 2017. All rights reserved.",e.appendChild(o),e},FloDialog.prototype.runEmbeddedJs=function(){for(var scripts=this.activeDialog.getElementsByTagName("script"),i=0;i<scripts.length;i++)eval(scripts[i].text)},FloDialog.prototype.setFooterText=function(t){this.footerText=t};